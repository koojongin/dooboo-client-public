(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5029],{65643:function(e,s,l){Promise.resolve().then(l.bind(l,8723))},8723:function(e,s,l){"use strict";l.r(s),l.d(s,{default:function(){return j}});var i=l(57437),t=l(2265),n=l(47907),a=l(10243),r=l(63411),c=l.n(r),d=l(40874),x=l(605),o=l(43951),m=l(26874),u=function(e){let{headCss:s,battleHandler:l,refreshInventory:n}=e,[r,m]=(0,t.useState)([]),[u,f]=(0,t.useState)(),[p,j]=(0,t.useState)(),[v,g]=(0,t.useState)([]),[w,N]=(0,t.useState)(!1),b=(0,t.useRef)(),y=(0,t.useRef)(null),C=e=>{e&&f(e)},S=async e=>{var s;if(j(null),!r.map(e=>e.name).includes(e))return E(),c().fire({title:"사냥터를 선택해주세요",text:"문제가 계속되면 관리자에게 문의해주세요",icon:"error",confirmButtonText:"확인"});N(!0);let i=await (0,x.ch)(e);((null==i?void 0:null===(s=i.drops)||void 0===s?void 0:s.length)||0)>0&&(n(),z()),j(i),g(i.battleLogs),i.isWin&&await l.refreshCharacterComponent()},_=e=>{b.current||(b.current=setInterval(async()=>{try{await S(e)}catch(e){E()}},5e3))},I=new Audio("/audio/item_drop.mp3"),k=new Audio("/audio/end_of_battle.mp3"),E=(0,t.useCallback)(()=>{N(!1),b.current&&(u&&(null==b?void 0:b.current)&&(k.volume=.5,k.play()),clearInterval(b.current),b.current=void 0)},[u]),L=e=>{if(w)E();else{N(!0);try{_(e)}catch(e){N(!1)}}},T=(0,t.useCallback)(async()=>{let{maps:e}=await (0,x.QN)();m(e)},[]),z=()=>{I.volume=.1,I.play()},H=()=>{var e;console.log("onAnimationEnd"),null===(e=y.current)||void 0===e||e.scrollTo(0,9999999999999)};return(0,t.useEffect)(()=>(T(),()=>{E()}),[T,E]),(0,i.jsxs)(a.Card,{className:s,children:[(0,i.jsxs)("div",{className:"flex mb-5 px-[24px] pt-[20px]",children:[(0,i.jsx)("div",{className:"w-72",children:r&&r.length>0&&(0,i.jsx)(a.Select,{disabled:w,className:"rounded-r-none",label:"선택된 사냥터",value:u,onChange:e=>C(e),children:r.map(e=>(0,i.jsx)(a.Option,{value:e.name,children:e.name},(0,d.Z)()))})}),(0,i.jsx)(a.Button,{className:"rounded-l-none",color:w?"red":"indigo",size:"sm",variant:"filled",onClick:()=>L(u),children:w?"자동사냥중":"사냥하기"})]}),(0,i.jsx)("div",{className:"px-[24px] overflow-y-scroll max-h-[350px] h-[350px]",ref:y,children:p&&p.monster&&(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"flex gap-1 text-sm",children:[(0,i.jsx)("div",{children:"전투일시"}),(0,i.jsxs)("div",{children:[new Date(p.battledAt).toLocaleDateString()," ",new Date(p.battledAt).toLocaleTimeString()]})]}),(0,i.jsxs)("div",{className:"flex items-center mb-1 gap-1",children:[(0,i.jsx)("div",{children:(0,i.jsx)("img",{src:(0,o.Z)(p.monster.thumbnail),className:"max-w-[100px] rounded-lg"})}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"flex items-center text-[20px] gap-1",children:[(0,i.jsx)("div",{className:"rounded bg-indigo-400 text-white px-4 py-0.5",children:p.monster.name}),(0,i.jsx)("div",{className:"",children:"을/를 만났습니다."})]}),(0,i.jsxs)("div",{className:"text-[12px]",children:["HP:",p.monster.hp]})]})]}),(0,i.jsx)("div",{className:"text-white text-[16px]",children:v.map((e,s)=>(0,i.jsxs)("div",{className:"animate-slideIn flex items-center mb-1 gap-1 transition text-black opacity-0",onAnimationEnd:H,style:{"--delay":"".concat(.25*s,"s")},children:[(0,i.jsx)(a.Chip,{variant:"gradient",size:"sm",className:"text-[14px] rounded px-[4px] min-w-[70px] flex items-center justify-center py-[2px]",color:e.isCriticalHit?"red":"indigo",value:"".concat(s+1,"Turn")}),(0,i.jsxs)("div",{className:"flex items-center gap-1",children:[e.isCriticalHit&&(0,i.jsx)(a.Chip,{size:"sm",color:"yellow",value:"치명타!"}),(0,i.jsx)("div",{className:"bg-light-blue-300 ff-ba text-[20px] px-[6px] py-[1px] text-white rounded",children:e.damage.toFixed(2).toLocaleString()}),(0,i.jsx)("div",{children:"의 피해를 입혔습니다."})]}),(0,i.jsxs)("div",{className:"ml-auto",children:["남은 체력:",e.currentHp.toFixed(2)]})]},"battlelog-".concat(s)))}),(0,i.jsxs)("div",{className:"animate-slideIn transition flex flex-col opacity-0 text-[18px]",style:{"--delay":"".concat(.25*p.battleLogs.length,"s")},children:[(0,i.jsxs)("div",{className:"flex items-end mt-[10px]",children:["전투에서",(0,i.jsx)("span",{className:"pl-1 font-bold text-[20px] ".concat(p.isWin?"text-green-900":"text-red-800"),children:p.isWin?"승리":"패배"}),"했습니다!"]}),p.isWin&&(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"flex gap-1",children:[(0,i.jsx)(a.Chip,{color:"teal",variant:"gradient",size:"sm",value:"+".concat(p.monster.experience," exp")}),(0,i.jsx)(a.Chip,{color:"yellow",variant:"gradient",size:"sm",value:"+".concat(p.monster.gold," Gold")})]}),p.drops.length>0&&(0,i.jsx)(h,{drops:p.drops})]})]})]})})]})};function h(e){let{drops:s}=e;return(0,i.jsxs)("div",{className:"flex flex-col gap-1 mt-10",children:[(0,i.jsx)("div",{className:"bg-indigo-400 text-white text-[20px] pl-1",children:"획득한 아이템"}),(0,i.jsx)("div",{className:"flex flex-row gap-1",children:s.map(e=>(0,i.jsx)(m.We,{item:e,className:"border p-[2px]"},"drops_".concat(e._id)))})]})}var f=l(38687),p=function(e){let{user:s,character:l,nextExp:t,stat:n,equippedItems:r,refreshInventory:c,refreshMe:d}=e,u=async e=>{await (0,x.uw)(e._id),await Promise.all([c(),d()])};return(0,i.jsx)(a.Card,{className:"rounded min-w-[460px] w-full flex flex-col justify-start items-start min-h-40",children:(0,i.jsx)(a.CardBody,{className:"w-full",children:(0,i.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,i.jsxs)("div",{className:"flex gap-1",children:[(0,i.jsx)("div",{className:"w-[80px] h-[80px] min-w-[80px] min-h-[80px] border border-gray-600 rounded p-[1px] flex items-center justify-center",children:(0,i.jsx)("img",{className:"w-full",src:f.LJ})}),(0,i.jsxs)("div",{className:"w-full flex flex-col gap-[2px]",children:[(0,i.jsxs)("div",{className:"flex w-full justify-between",children:[(0,i.jsxs)("div",{children:["Lv.",l.level]}),(0,i.jsx)("div",{children:s.nickname})]}),(0,i.jsxs)("div",{className:"w-full flex justify-between",children:[(0,i.jsx)("div",{children:"골드"}),(0,i.jsx)("div",{children:l.gold.toLocaleString()})]}),(0,i.jsxs)("div",{className:"w-full flex justify-between items-center",children:[(0,i.jsx)("div",{children:"경험치"}),(0,i.jsx)("div",{children:(0,i.jsx)(a.Tooltip,{interactive:!0,content:"경험치 ".concat(l.experience," / ").concat(t),children:(0,i.jsxs)("div",{className:"min-w-[".concat(250,"px] max-w-[").concat(250,"px] min-h-[26px] flex justify-center items-center relative rounded-md overflow-hidden border-2 border-blue-200 noselect cursor-pointer"),children:[(0,i.jsx)("div",{className:"absolute left-0 max-w-[300px] min-h-full opacity-80 z-20",style:{width:"".concat(l.experience/t*250,"px"),background:"linear-gradient(90deg, rgba(2,0,36,1) 0%, rgba(9,9,121,1) 35%, rgba(0,212,255,1) 100%)",transition:"width 1s"}}),(0,i.jsx)("div",{className:"absolute min-w-[".concat(250,"px] max-w-[{EXP_WIDTH$px] min-h-full bg-blue-100")}),(0,i.jsxs)("div",{className:"z-20 absolute min-w-[".concat(250,"px] max-w-[{EXP_WIDTH$px] min-h-full flex items-center justify-center text-white ff-ba text-[20px] leading-[20px]"),children:[(l.experience/t*100).toFixed(2),"%"]})]})})})]})]})]}),(0,i.jsxs)("div",{className:"w-full flex justify-between",children:[(0,i.jsx)("div",{children:"물리 피해"}),(0,i.jsx)("div",{children:n.damageOfPhysical})]}),(0,i.jsxs)("div",{className:"w-full flex justify-between",children:[(0,i.jsx)("div",{children:"화염 피해"}),(0,i.jsx)("div",{children:n.damageOfFire})]}),(0,i.jsxs)("div",{className:"w-full flex justify-between",children:[(0,i.jsx)("div",{children:"냉기 피해"}),(0,i.jsx)("div",{children:n.damageOfCold})]}),(0,i.jsxs)("div",{className:"w-full flex justify-between",children:[(0,i.jsx)("div",{children:"번개 피해"}),(0,i.jsx)("div",{children:n.damageOfLightning})]}),(0,i.jsxs)("div",{className:"w-full flex justify-between",children:[(0,i.jsx)("div",{children:"치명타 확률"}),(0,i.jsxs)("div",{children:[n.criticalRate.toFixed(2),"%"]})]}),(0,i.jsxs)("div",{className:"w-full flex justify-between",children:[(0,i.jsx)("div",{children:"치명타 배율"}),(0,i.jsxs)("div",{children:["+",n.criticalMultiplier,"%"]})]}),(0,i.jsx)("hr",{className:"mb-1"}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{children:"착용장비"}),(0,i.jsxs)("div",{className:"flex flex-col gap-1",children:[(null==r?void 0:r.length)===0&&(0,i.jsx)("div",{className:"w-full min-h-[30px] border border-gray-300 rounded flex justify-center items-center",children:"착용된 장비가 없습니다."}),(null==r?void 0:r.length)>0&&r.map(e=>(0,i.jsxs)("div",{className:"flex gap-1",children:[(0,i.jsx)("div",{className:"min-w-[30px] min-h-[30px] border border-gray-300 rounded flex justify-center items-center bg-red-300 text-white cursor-pointer",onClick:()=>u(e),children:"x"}),(0,i.jsx)(a.Tooltip,{className:"rounded-none bg-transparent",interactive:!0,content:(0,i.jsx)(m.VQ,{item:e,actions:[m.jD.Share]}),children:(0,i.jsxs)("div",{className:"pl-[3px] w-full min-h-[30px] border border-gray-300 rounded flex justify-start items-center gap-1",children:[(0,i.jsx)("img",{src:(0,o.Z)(e.weapon.thumbnail),className:"w-[24px] h-[24px] border rounded"}),(0,i.jsx)("div",{children:e.weapon.name})]})})]},"".concat(e._id,"_equipped")))]})]})]})})})};function j(){let e=(0,n.useRouter)(),[s,l]=(0,t.useState)(null),[a,r]=(0,t.useState)(null),[c,d]=(0,t.useState)(0),[o,h]=(0,t.useState)(),[f,j]=(0,t.useState)([]),v=(0,t.useRef)(null),g=async()=>{try{let{nextExp:e,user:s,character:i,stat:t,equippedItems:n}=await (0,x.aM)();localStorage.setItem("characterId",i._id),l(s),r(i),d(e),h(t),j(n)}catch(i){let{response:s}=i||{},{data:l}=s||{};if((null==l?void 0:l.message)==="NotFoundCharacter"){let s=localStorage.getItem("token");e.push("/register?accessToken=".concat(s))}}},w=()=>{var e;null==v||null===(e=v.current)||void 0===e||e.refresh()};return(0,t.useEffect)(()=>{g()},[]),(0,i.jsx)("div",{className:"w-full",children:(0,i.jsxs)("div",{className:"items-center flex flex-col w-full",children:[(0,i.jsx)("div",{className:"w-full min-h-80 grid grid-cols-8 justify-center items-center mb-2",children:s&&(0,i.jsx)(u,{headCss:"col-span-8 h-full rounded w-full",battleHandler:{refreshCharacterComponent:async()=>{await g()}},refreshInventory:w})}),(0,i.jsxs)("div",{className:"justify-between w-full flex gap-1",children:[s&&(0,i.jsx)(p,{character:a,user:s,nextExp:c,stat:o,equippedItems:f,refreshInventory:w,refreshMe:g}),s&&(0,i.jsx)(m.ZP,{ref:v,refreshInventory:w,refreshMe:g,equippedItems:f})]})]})})}}},function(e){e.O(0,[6384,9461,6990,1866,8694,7908,7187,7391,6874,2971,8069,1744],function(){return e(e.s=65643)}),_N_E=e.O()}]);